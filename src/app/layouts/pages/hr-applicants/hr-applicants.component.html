<h2 class="title">‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏±‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏á‡∏≤‡∏ô</h2>

<div class="d-flex gap-2 mb-3">
  <button class="btn btn-success" (click)="exportExcel()">üì§ Export</button>

  <button class="btn btn-outline-success" (click)="fileInput.click()">üì• Import</button>

  <input type="file" #fileInput hidden accept=".xlsx,.xls" (change)="Import($event)" />
</div>



<form [formGroup]="filterForm" class="filter-bar">
  <input type="text" formControlName="keyword" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ CID ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ä‡∏∑‡πà‡∏≠" />

  <select formControlName="status">
    <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
    <option value="‡∏ú‡πà‡∏≤‡∏ô">‡∏ú‡πà‡∏≤‡∏ô</option>
    <option value="‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô">‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô</option>
    <option value="‡∏¢‡∏∑‡πà‡∏ô‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏á‡∏≤‡∏ô">‡∏¢‡∏∑‡πà‡∏ô‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏á‡∏≤‡∏ô</option>
     <option value="‡∏£‡∏≠‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå">‡∏£‡∏≠‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå</option>
  </select>

  <button type="button" (click)="applyFilter()">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
</form>

<table>
  <thead>
    <tr>
      <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
      <th><input type="checkbox" (change)="toggleAll($event)" /></th>
      <th>‡∏ä‡∏∑‡πà‡∏≠ - ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
      <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏™‡∏°‡∏±‡∏Ñ‡∏£</th>
      <th>‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</th>
      <th>‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
      <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
      <th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
    </tr>
  </thead>

  <tbody>
    <tr *ngFor="let a of filteredApplicants; let i = index" [class.duplicate-row]="a.isDuplicate">
      <td>{{ (currentPage - 1) * limit + i + 1 }}</td>

      <td>
        <input type="checkbox" [(ngModel)]="a.selected" />
      </td>

      <td>{{ a.first_name }} {{ a.last_name }}</td>
      <td>{{ a.apply_date | date }}</td>
      <td>
        {{ a.national_id }}
        <span *ngIf="a.isDuplicate" class="badge bg-warning text-dark ms-2">
          ‡∏ã‡πâ‡∏≥
        </span>
      </td>

      <td>{{ a.education_level }}</td>

      <td>
        <span [class.pass]="a.interview_status === '‡∏ú‡πà‡∏≤‡∏ô'"
          [class.fail]="a.interview_status === '‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô' || a.interview_status === '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'"
          [class.pending]="a.interview_status === '‡∏¢‡∏∑‡πà‡∏ô‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏á‡∏≤‡∏ô'" [class.waiting]="a.interview_status === '‡∏£‡∏≠‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå'">
          {{ a.interview_status }}
        </span>
      </td>

      <td>
        <button class="btn btn-outline-primary btn-sm" (click)="openDrawer(a)">
          ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
        </button>

      </td>
      <td *ngIf="a.interview_status !== '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'">
        <button class="btn btn-outline-danger btn-sm" (click)="onUpdateStatus(a.id)">
          ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
        </button>

      </td>
    </tr>
  </tbody>

</table>
<div class="pagination-bar">

  <button class="page-btn" [disabled]="currentPage === 1" (click)="GetUserApplicants(currentPage - 1)">
    ‚óÄ
  </button>

  <button *ngFor="let p of pages" class="page-btn" [class.active]="p === currentPage" (click)="GetUserApplicants(p)">
    {{ p }}
  </button>

  <button class="page-btn" [disabled]="currentPage === totalPages" (click)="GetUserApplicants(currentPage + 1)">
    ‚ñ∂
  </button>

</div>

<div class="action-bar">
  <button type="button" class="btn-primary" (click)="updateStatus('‡∏ú‡πà‡∏≤‡∏ô')">‚úî ‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</button>
  <button type="button" class="btn-secondary" (click)="updateStatus('‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô')">‚úñ ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</button>
</div>



<!-- ================= Applicant Detail Dialog ================= -->


<!-- Backdrop -->
<div class="drawer-backdrop" *ngIf="showDrawer" (click)="closeDrawer()"></div>

<!-- Drawer -->
<div class="drawer-panel" [class.open]="showDrawer">

  <!-- Header -->
  <div class="drawer-header premium-header">
    <div class="d-flex align-items-center gap-2">
      <span class="header-icon">üìÑ</span>
      <h5 class="mb-0 fw-bold">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏á‡∏≤‡∏ô</h5>
    </div>
    <button class="btn-close btn-close-white" (click)="closeDrawer()"></button>
  </div>

  <!-- Body -->
  <div class="drawer-body" *ngIf="selectedApplicant">

    <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£ -->
    <div class="soft-card mb-4">
      <h6 class="section-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£</h6>
      <div class="row g-3">
        <div class="col-6">
          <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£</label>
          <div>{{ selectedApplicant.apply_date | date }}</div>
        </div>
        <div class="col-6">
          <label>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</label>
          <div>{{ selectedApplicant.position_applied }}</div>
        </div>
        <div class="col-6">
          <label>‡∏ù‡πà‡∏≤‡∏¢</label>
          <div>{{ selectedApplicant.department }}</div>
        </div>
        <div class="col-6">
          <label>‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</label>
          <div>{{ selectedApplicant.company }}</div>
        </div>
      </div>
    </div>

    <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ -->
    <div class="soft-card mb-4">
      <h6 class="section-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</h6>
      <div class="row g-3">
        <div class="col-6">
          <label>‡∏ä‡∏∑‡πà‡∏≠ - ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
          <div>
            {{ selectedApplicant.title }}
            {{ selectedApplicant.first_name }}
            {{ selectedApplicant.last_name }}
          </div>
        </div>
        <div class="col-6">
          <label>CID</label>
          <div>{{ selectedApplicant.national_id }}</div>
        </div>
        <div class="col-6">
          <label>‡πÇ‡∏ó‡∏£</label>
          <div>{{ selectedApplicant.phone }}</div>
        </div>
        <div class="col-6">
          <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
          <span class="badge rounded-pill" [class.bg-success]="selectedApplicant.interview_status==='‡∏ú‡πà‡∏≤‡∏ô'"
            [class.bg-danger]="selectedApplicant.interview_status==='‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô'"
            [class.bg-warning]="selectedApplicant.interview_status==='‡∏£‡∏≠‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå'"
            [class.bg-warning]="selectedApplicant.interview_status==='‡∏¢‡∏∑‡πà‡∏ô‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏á‡∏≤‡∏ô'"
            [class.bg-secondary]="selectedApplicant.interview_status==='‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'">



            {{ selectedApplicant.interview_status }}
          </span>
        </div>
      </div>
    </div>

    <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° -->
    <div class="soft-card">
      <h6 class="section-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</h6>
      <div class="row g-3">
        <div class="col-6">
          <label>‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</label>
          <div>{{ selectedApplicant.expected_salary | number }} ‡∏ö‡∏≤‡∏ó</div>
        </div>
        <div class="col-6">
          <label>‡∏ß‡∏∏‡∏í‡∏¥‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label>
          <div>{{ selectedApplicant.education_level }}</div>
        </div>
        <div class="col-6">
          <label>‡∏≠‡∏≤‡∏¢‡∏∏</label>
          <div>{{ selectedApplicant.age }} ‡∏õ‡∏µ</div>
        </div>
        <div class="col-6">
          <label>‡∏†‡∏≤‡∏©‡∏≤</label>
          <div>{{ selectedApplicant.language_skills }}</div>
        </div>
      </div>
    </div>

  </div>
  <!-- Footer -->
  <!-- Footer -->
  <div class="drawer-footer" *ngIf="selectedApplicant.interview_status !== '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'">
    <button class="btn btn-primary" (click)="openInterviewModal()">
      üìÖ ‡∏ô‡∏±‡∏î‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå
    </button>
  </div>


</div>
<app-interview-modal *ngIf="showInterviewModal" [applicant]="selectedApplicant" (save)="saveInterview($event)"
  (close)="showInterviewModal=false">
</app-interview-modal>